# Use the latest 2.1 version of CircleCI pipeline process engine.
# See: https://circleci.com/docs/configuration-reference
version: 2.1

# Define a job to be invoked later in a workflow.
# See: https://circleci.com/docs/configuration-reference/#jobs
jobs:
  say-hello:
    # Specify the execution environment. You can specify an image from Docker Hub or use one of our convenience images from CircleCI's Developer Hub.
    # See: https://circleci.com/docs/configuration-reference/#executor-job
    docker:
      - image: debian:trixie
    resource_class: arm.xlarge
    # Add steps to the job
    # See: https://circleci.com/docs/configuration-reference/#steps
    steps:
      - run: apt update
      - run: apt upgrade -y
      - run: apt install -y git build-essential bison flex python3 python3-debian python3-jinja2 rsync kernel-wedge quilt bc pahole libssl-dev libelf-dev
      - checkout
      - run: debian/bin/genorig.py https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git
      - run: debian/rules orig
      - run: debian/rules debian/control-real || true
      - run: make -j8 -f debian/rules.gen binary-arch_arm64_none_arm64_image
      - run: ls -la .
      - store_artifacts: 
          path: ../*.deb
          destination: artifact_name

# Orchestrate jobs using workflows
# See: https://circleci.com/docs/configuration-reference/#workflows
workflows:
  say-hello-workflow:
    jobs:
      - say-hello
